version: "3"
services:
  mongodb:
    image: mongo:3.6
    restart: unless-stopped
    container_name: neuvue-mongodb
    networks:
      - neuvue
    volumes:
      - mongo-data:/data/db
      - /data/archive:/data/archive/
  neuvue-queue:
    image: 473318664541.dkr.ecr.us-east-1.amazonaws.com/aplbrain/neuvue-queue:latest
    #image: neuvue-test:staging
    restart: unless-stopped
    container_name: neuvue-queue
    environment:
      NEUVUEQUEUE_MONGODB_DATABASE: neuvue
      NEUVUEQUEUE_MONGODB_HOST: mongodb
      VIRTUAL_HOST: queue.neuvue.io
      LETSENCRYPT_HOST: queue.neuvue.io
      AUTH0_DOMAIN: ${AUTH0_DOMAIN}
      AUTH0_AUDIENCE: ${AUTH0_AUDIENCE}
      AUTH0_CLIENTID: ${AUTH0_CLIENTID}
      AUTH0CLIENTSECRET: ${AUTH0CLIENTSECRET}
    networks:
      - neuvue
    volumes:
      - ./configs/neuvue-config.json:/etc/neuvue-queue/default.json:ro
    depends_on:
      - mongodb
  mongo-grove:
    image: 473318664541.dkr.ecr.us-east-1.amazonaws.com/aplbrain/mongo-grove
    container_name: neuvue-mongo-grove
    restart: unless-stopped
    environment:
      MONGO_HOST: neuvue-mongodb
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
    networks:
      - neuvue
    depends_on:
      - mongodb
networks:
  neuvue:
    external: true
volumes:
  mongo-data:
